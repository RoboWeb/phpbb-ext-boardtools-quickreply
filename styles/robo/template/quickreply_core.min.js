!function($,window,document){"use strict";var qrAlertTimer=null,qrBoxShadowHeight=15,qrCompactHeight=48,qrDefaultStyle="height: 9em;",qrSlideInterval=quickreply.settings.softScroll?quickreply.settings.scrollInterval:0,qrSmileyBoxAnimationInterval=500,$body=$("body");quickreply.settings.pluploadEnabled&&(phpbb.plupload.config.form_hook=quickreply.editor.mainForm),quickreply.settings.attachBox&&$("#file-list").on("click","a[href]",(function(){$(this).attr("target","__blank")})),initGlobalFunctions(),quickreply.$=new QrJqueryElements,quickreply.loading=new Loading,quickreply.ajax=new Ajax,quickreply.ajaxReload=new AjaxReload,quickreply.form=new QrForm,quickreply.preview=new Preview,quickreply.loading.init(),quickreply.ajax.init(),quickreply.form.init(),quickreply.settings.enableWarning&&($(window).on("beforeunload.quickreply",(function(){if(quickreply.form.hasReply())return quickreply.language.WARN_BEFORE_UNLOAD})),quickreply.settings.ajaxSubmit||quickreply.$.mainForm.submit((function(){$(window).off("beforeunload.quickreply")})));var qrStopHistory=!1,qrReplaceHistory=!1;if((quickreply.settings.ajaxSubmit||quickreply.settings.ajaxPagination)&&($(window).on("popstate",(function(e){var state=e.originalEvent.state;state&&(qrStopHistory=!0,document.title=state.title,quickreply.ajaxReload.start(state.url))})),phpbb.history.isSupported("state"))){$(window).on("unload",(function(){var currentState=history.state,d=new Date;null!==currentState&&currentState.replaced&&phpbb.history.replaceUrl(window.location.href+"&ajax_time="+d.getTime(),document.title,currentState)}));var currentState=history.state;null!==currentState?phpbb.history.replaceUrl(window.location.href.replace(/&ajax_time=\d*/i,""),document.title,currentState):phpbb.history.replaceUrl(window.location.href,document.title,{url:window.location.href,title:document.title})}quickreply.style.initPagination();var restoredMessage=$(quickreply.editor.messageStorage).html();function initGlobalFunctions(){quickreply.functions.softScroll=function(target,container){target.length&&$(container=container||"html,body").animate({scrollTop:target.offset().top},qrSlideInterval)},quickreply.functions.alert=function(title,text){quickreply.functions.clearLoadingTimeout();var $alert=phpbb.alert(title,text);qrAlertTimer=setTimeout((function(){phpbb.alert.close($alert,!0)}),5e3)},quickreply.functions.clearLoadingTimeout=function(){null!==qrAlertTimer&&(clearTimeout(qrAlertTimer),qrAlertTimer=null),phpbb.clearLoadingTimeout()},quickreply.functions.pageJump=function($item){if(quickreply.settings.saveReply)if(quickreply.plugins.seo)quickreply.functions.seoPageJump($item);else{var page=parseInt($item.val(),10);if(null!==page&&!isNaN(page)&&page===Math.floor(page)&&page>0){var perPage=$item.attr("data-per-page"),baseUrl=$item.attr("data-base-url"),startName=$item.attr("data-start-name");-1===baseUrl.indexOf("?")?quickreply.ajaxReload.loadPage(baseUrl+"?"+startName+"="+(page-1)*perPage):quickreply.ajaxReload.loadPage(baseUrl.replace(/&amp;/g,"&")+"&"+startName+"="+(page-1)*perPage)}}else pageJump($item)},quickreply.functions.seoPageJump=function($item){var page=parseInt($item.val(),10);if(null!==page&&!isNaN(page)&&page===Math.floor(page)&&page>0){var per_page=$item.attr("data-per-page"),base_url=$item.attr("data-base-url"),start_name=$item.attr("data-start-name"),anchor="",anchor_parts=base_url.split("#");if(anchor_parts[1]&&(base_url=anchor_parts[0],anchor="#"+anchor_parts[1]),phpbb_seo.page=(page-1)*per_page,phpbb_seo.page>0){var phpEXtest=!1;if("start"!==start_name||base_url.indexOf("?")>=0||(phpEXtest=base_url.match("/."+phpbb_seo.phpEX+"$/i")))quickreply.ajaxReload.loadPage(base_url.replace(/&amp;/g,"&")+(phpEXtest?"?":"&")+start_name+"="+phpbb_seo.page+anchor);else{var ext=base_url.match(/\.[a-z0-9]+$/i);if(ext)quickreply.ajaxReload.loadPage(base_url.replace(/\.[a-z0-9]+$/i,"")+phpbb_seo.delim_start+phpbb_seo.page+ext+anchor);else{var slash=base_url.match(/\/$/)?"":"/";quickreply.ajaxReload.loadPage(base_url+slash+phpbb_seo.static_pagination+phpbb_seo.page+phpbb_seo.ext_pagination+anchor)}}}else quickreply.ajaxReload.loadPage(base_url+anchor)}}}function handleDrops($container){$container.find(".dropdown-container").each((function(){var $this=$(this),$trigger=$this.find(".dropdown-trigger:first"),$contents=$this.find(".dropdown"),options={direction:"auto",verticalDirection:"auto"},data;$trigger.length||($trigger=(data=$this.attr("data-dropdown-trigger"))?$this.children(data):$this.children("a:first")),$contents.length||($contents=(data=$this.attr("data-dropdown-contents"))?$this.children(data):$this.children("div:first")),$trigger.length&&$contents.length&&($this.hasClass("dropdown-up")&&(options.verticalDirection="up"),$this.hasClass("dropdown-down")&&(options.verticalDirection="down"),$this.hasClass("dropdown-left")&&(options.direction="left"),$this.hasClass("dropdown-right")&&(options.direction="right"),phpbb.registerDropdown($trigger,$contents,options))}))}function qrResponsiveLinks($container){var selector=".linklist:not(.navlinks, [data-skip-responsive]),.postbody .post-buttons:not([data-skip-responsive])";$container.find(selector).each((function(){var $this=$(this),filterSkip=".breadcrumbs, [data-skip-responsive]",filterLast=".edit-icon, .quote-icon, [data-last-responsive]",$linksAll=$this.children(),$linksNotSkip=$linksAll.not(filterSkip),$linksFirst=$linksNotSkip.not(filterLast),$linksLast=$linksNotSkip.filter(filterLast),persistent="nav-main"===$this.attr("id"),html='<li class="responsive-menu hidden"><a href="javascript:void(0);" class="js-responsive-menu-link responsive-menu-link"><i class="icon fa-bars fa-fw" aria-hidden="true"></i></a><div class="dropdown"><div class="pointer"><div class="pointer-inner" /></div><ul class="dropdown-contents" /></div></li>',slack=3;persistent||($linksNotSkip.is(".rightside")?($linksNotSkip.filter(".rightside:first").before(html),$this.children(".responsive-menu").addClass("rightside")):$this.append(html));var $menu=$this.children(".responsive-menu"),$menuContents=$menu.find(".dropdown-contents"),persistentContent=$menuContents.find("li:not(.separator)").length,lastWidth=!1,compact=!1,responsive1=!1,responsive2=!1,copied1=!1,copied2=!1,maxHeight=0;function check(){var width=$body.width();if(!(responsive2&&compact&&width<=lastWidth||(lastWidth=width,(responsive1||responsive2)&&($linksNotSkip.removeClass("hidden"),$menuContents.children(".clone").addClass("hidden"),responsive1=responsive2=!1),compact&&($this.removeClass("compact"),compact=!1),persistent&&persistentContent?$menu.removeClass("hidden"):$menu.addClass("hidden"),$this.height()<=maxHeight||(compact||($this.addClass("compact"),compact=!0),$this.height()<=maxHeight)))){if(compact&&($this.removeClass("compact"),compact=!1),!copied1){var $clones1=$linksFirst.clone();$menuContents.prepend($clones1.addClass("clone clone-first").removeClass("leftside rightside")),$this.hasClass("post-buttons")&&($(".button",$menuContents).removeClass("button"),$(".sr-only",$menuContents).removeClass("sr-only"),$(".js-responsive-menu-link").addClass("button").addClass("button-icon-only"),$(".js-responsive-menu-link .icon").removeClass("fa-bars").addClass("fa-ellipsis-h")),copied1=!0}if(responsive1||($linksFirst.addClass("hidden"),responsive1=!0,$menuContents.children(".clone-first").removeClass("hidden"),$menu.removeClass("hidden")),!($this.height()<=maxHeight)&&(compact||($this.addClass("compact"),compact=!0),!($this.height()<=maxHeight)&&$linksLast.length)){if(compact&&($this.removeClass("compact"),compact=!1),!copied2){var $clones2=$linksLast.clone();$menuContents.prepend($clones2.addClass("clone clone-last").removeClass("leftside rightside")),copied2=!0}responsive2||($linksLast.addClass("hidden"),responsive2=!0,$menuContents.children(".clone-last").removeClass("hidden")),$this.height()<=maxHeight||compact||($this.addClass("compact"),compact=!0)}}}$linksAll.each((function(){$(this).height()&&(maxHeight=Math.max(maxHeight,$(this).outerHeight(!0)))})),maxHeight<1||(maxHeight+=3,persistent||phpbb.registerDropdown($menu.find("a.js-responsive-menu-link"),$menu.find(".dropdown"),!1),$linksAll.find("img").each((function(){$(this).load((function(){check()}))})),check(),$(window).resize(check))}))}function QrJqueryElements(){this.qrPosts=$("#qr_posts"),this.mainForm=$(quickreply.editor.mainForm),this.messageBox=this.mainForm.find("#message-box"),this.textarea=$(quickreply.editor.textareaSelector)}function Loading(){var self=this,waitTimer=null,stopTimer=null;function clearTimeouts(){waitTimer&&(clearTimeout(waitTimer),waitTimer=null),stopTimer&&(clearTimeout(stopTimer),stopTimer=null)}function setTimeouts(){clearTimeouts(),waitTimer=setTimeout((function(){self.setExplain(quickreply.language.loading.WAIT,!1,!0)}),1e4),stopTimer=setTimeout((function(){self.stop(!0),quickreply.ajax.error($("#darkenwrapper").attr("data-ajax-error-text-timeout"))}),2e4)}this.start=function(){var $dark=$("#darkenwrapper"),$loadingText=$("#loading_indicator");$loadingText.is(":visible")||(quickreply.functions.clearLoadingTimeout(),$("#phpbb_alert").hide(),$dark.off("click"),$dark.is(":visible")||$dark.fadeIn(phpbb.alertTime),$loadingText.fadeIn(phpbb.alertTime)),setTimeouts()},this.setExplain=function(text,showCancelButton,skipTimeouts){$("#qr_loading_cancel").fadeOut(phpbb.alertTime),$("#qr_loading_explain").fadeOut(phpbb.alertTime,(function(){$(this).html(text).fadeIn(phpbb.alertTime),showCancelButton&&$("#qr_loading_cancel").fadeIn(phpbb.alertTime)})),showCancelButton?clearTimeouts():skipTimeouts||setTimeouts()},this.stop=function(keepDark){var $dark=$("#darkenwrapper"),$loadingText;$("#loading_indicator").fadeOut(phpbb.alertTime),$("#qr_loading_explain").fadeOut(phpbb.alertTime,(function(){$(this).html(""),$("#qr_loading_cancel").hide()})),keepDark||$dark.fadeOut(phpbb.alertTime),clearTimeouts()},this.proceed=function(){$("#darkenwrapper").stop().fadeIn(phpbb.alertTime)},this.init=function(){$("#loading_indicator").append('<div id="qr_loading_explain"></div><div id="qr_loading_cancel"><span>'+quickreply.language.CANCEL_SUBMISSION+"</span></div>"),$("#loading_indicator").on("click",(function(){quickreply.$.mainForm.off("ajax_submit_ready").trigger("ajax_submit_cancel"),self.stop()})),$(document).ajaxError((function(){var $loadingText=$("#loading_indicator");$loadingText.is(":visible")&&$loadingText.fadeOut(phpbb.alertTime)}))}}function QrForm(){var self=this,smileyBoxDisplayed=!1,hasAttachments=!1,formHeight=null,formWidth=null;function uploaderIsAvailable(){return phpbb.plupload&&phpbb.plupload.uploader}function setAttachNotice(visibility,animationOptions){if(hasAttachments){var slideFunction={show:"show",toggle:"slideToggle",hide:"slideUp"}[visibility]||"slideDown",options="show"===visibility?null:animationOptions||qrSlideInterval;console.log("setAttachNotice",{slideFunction:slideFunction,options:options,"#qr_attach_notice":$("#qr_attach_notice")}),$("#qr_attach_notice").finish()[slideFunction](options)}}function initAttachNotice(){$(document).ready((function(){uploaderIsAvailable()&&(phpbb.plupload.uploader.bind("PostInit",(function(){$("#file-list").children().length&&(hasAttachments=!0,$("#qr_attach_notice").show())})),phpbb.plupload.uploader.bind("FilesAdded",(function(){setAttachNotice("hide"),hasAttachments=!0,$(quickreply.editor.attachPanel).is(":visible")||$(quickreply.editor.attachPanel).finish().slideDown(qrSlideInterval)})),phpbb.plupload.uploader.bind("FilesRemoved",(function(){phpbb.plupload.uploader.files.length||(hasAttachments=!1,$("#qr_attach_notice").finish().slideUp(qrSlideInterval))})))}))}function bindRefreshUploader(){uploaderIsAvailable()?$(".qr_attach_button").one("click",(function(){phpbb.plupload.uploader.refresh()})):$(".qr_attach_button").attr("data-subpanel","attach-panel")}function addToggleButton(){var $toggle=$('<div id="qr_show_fixed_form"><i class="fa fa-fw fa-comment"></i><span>'+quickreply.language.QUICKREPLY+"</span></div>").click((function(){quickreply.style.showQuickReplyForm(),exitHidden()})).insertAfter(self.$);(quickreply.settings.fixEmptyForm||self.hasReply())&&$toggle.hide(),console.log("addToggleButton",{$toggle:$toggle})}function setDelayForAttachments(){self.$.find(":submit").click((function(e){self.checkAttachments()&&(e.preventDefault(),quickreply.loading.start(),quickreply.loading.setExplain(quickreply.language.loading.ATTACHMENTS,!0),self.$.on("ajax_submit_ready",(function(){self.$.submit()})))}))}function hideColourPalette(){console.log("hideColorPalette")}function fixSmileyHeight(){$("#smiley-box").css("height",quickreply.$.messageBox.height())}function openSmileyBox(){setSmileyBox(),isMobile()?$("#smiley-box").slideDown(qrSlideInterval):$("#smiley-box").stop().animate({right:"0"},500),self.$.addClass("with_smileys"),smileyBoxDisplayed=!0}function closeSmileyBox(){isMobile()?$("#smiley-box").slideUp(qrSlideInterval):($("#smiley-box").stop().animate({right:"-1000px"},500),self.$.off("fullscreen.quickreply.smilies"),quickreply.$.textarea.off("mousemove.quickreply.smilies")),self.$.removeClass("with_smileys"),smileyBoxDisplayed=!1}function setSmileyBox(){self.is("extended")||(isMobile()?($("#smiley-box").css("height","")[smileyBoxDisplayed?"show":"hide"](),self.$.off("fullscreen.quickreply.smilies"),quickreply.$.textarea.off("mousemove.quickreply.smilies")):(fixSmileyHeight(),$("#smiley-box").css("display","").css("right",smileyBoxDisplayed?"0":"-1000px"),self.$.on("fullscreen.quickreply.smilies",fixSmileyHeight),quickreply.$.textarea.on("mousemove.quickreply.smilies",fixSmileyHeight)))}function addButtonTrigger(trigger,target,callback){$(trigger).click((function(){$(target).finish().slideToggle(qrSlideInterval),"function"==typeof callback&&callback()}))}function setFormWidth(){var $pageBody=$("#mbrs > .chunk");!$pageBody.length||self.is("extended")||self.is("fullscreen")||self.$.css("width",isMobile()?"100%":$pageBody.width())}function isMobile(){return $(window).width()<=700}function checkExtendedStateChange(duration,interval){duration-=interval,checkExtended(),duration>0&&setTimeout((function(){checkExtendedStateChange(duration,interval)}),interval)}function checkExtended(){if(!self.is("fullscreen")){var $window=$(window),$previous=self.$.prevAll(":visible:first"),scrollBottom=$window.scrollTop()+$window.height()-quickreply.style.getPageBottomValue(),formOffset=$previous.offset().top+$previous.height(),formHeight;scrollBottom-(self.is("hidden")?0:self.$.height())>=formOffset&&!self.is("extended")?setExtended():scrollBottom-(self.is("hidden")?0:48)<formOffset&&self.is("extended")&&exitExtended()}}function setExtended(){$("#qr_form_placeholder").remove(),$(".qr_attach_button:first").click(),self.$.finish().removeClass("qr_fixed_form qr_compact_form").addClass("no_transition qr_extended_form").css("width",""),quickreply.$.textarea.removeClass("qr_fixed_textarea"),$("#qr_action_box, #qr_text_action_box, #qr_show_fixed_form").hide(),closeSmileyBox(),$("#smiley-box").finish().css("left","").css("right","").css("height","").css("display",""),quickreply.style.formEditorElements(!0).finish().show(),setAttachNotice("hide"),setTimeout((function(){self.$.removeClass("no_transition")}),0)}function exitExtended(){var placeholderHeight=self.$.height();quickreply.$.textarea.addClass("qr_fixed_textarea"),self.$.finish().addClass("no_transition qr_fixed_form").removeClass("qr_extended_form"),$('<div id="qr_form_placeholder" />').css("height",placeholderHeight).insertAfter(self.$),$("#qr_action_box, #qr_text_action_box, #qr_captcha_container, .quickreply-buttons").show(),quickreply.$.textarea.val()||quickreply.$.textarea.is(":focus")?(quickreply.style.showQuickReplyForm(),quickreply.style.formEditorElements().hide(),setAttachNotice("show"),self.is("hidden")?$("#qr_show_fixed_form").show():exitHidden(!0)):self.setCompact(!0),setFormWidth(),setTimeout((function(){self.$.removeClass("no_transition")}),0)}function setHidden(immediate){var slideInterval=immediate?0:qrSlideInterval;self.$.finish().animate({bottom:-self.$.height()-15+"px"},slideInterval).addClass("qr_hidden_form"),$("#qr_show_fixed_form").show(),checkExtended()}function exitHidden(immediate){var slideInterval=immediate?0:qrSlideInterval;self.$.finish().animate({bottom:quickreply.style.getPageBottomValue()},slideInterval).removeClass("qr_hidden_form"),$("#qr_show_fixed_form").hide(),quickreply.$.textarea.focus()}function setFullscreen(){formHeight=self.$.height(),formWidth=self.$.width(),$body.add("html").css("overflow-y","hidden"),quickreply.style.formEditorElements(!0).slideDown(qrSlideInterval),setAttachNotice("hide"),$("#qr_text_action_box, .qr_attach_button").hide(),$(".qr_fullscreen_button").toggleClass("fa-arrows-alt fa-times").attr("title",quickreply.language.FULLSCREEN_EXIT),self.$.find(".qr_smiley_button").delay(qrSlideInterval/10).fadeIn().end(),quickreply.$.textarea.removeClass("qr_fixed_textarea"),$(document).on("keydown.quickreply.fullscreen",(function(e){27===e.keyCode&&(self.exitFullscreen(),e.preventDefault(),e.stopPropagation())})),self.$.on("ajax_submit_success.quickreply.fullscreen",self.exitFullscreen),self.$.trigger("fullscreen-before"),$(".qr_fixed_form").addClass("qr_fullscreen_form").animate({maxHeight:"100%",height:"100%",padding:"92px 0"},qrSlideInterval,(function(){$("#preview").prependTo(self.$),self.$.trigger("fullscreen")}))}function attachmentsChecker(){$(".file-progress:visible").length||self.$.trigger("ajax_submit_ready")}self.$=$(quickreply.editor.mainForm),console.log("QrForm",this),this.is=function(type){return self.$.hasClass("qr_"+type+"_form")},this.hasReply=function(){return!(!quickreply.$.textarea.val()&&!$("#file-list").children().not("#attach-row-tpl").length)},this.init=function(){if(quickreply.style.setTextareaId(),quickreply.settings.formType>0&&self.initFixed(),setDelayForAttachments(),quickreply.settings.ajaxSubmit){var $topicPostId=self.$.find('input[name="topic_cur_post_id"]');$topicPostId.attr("data-qr-topic-post",$topicPostId.val()).val("0")}},this.show=function(){quickreply.style.showQuickReplyForm(),exitHidden()},this.updateFields=function(qrFields){var formSubmitButtons=self.$.children().children().children(".quickreply-buttons");if(formSubmitButtons.children(':not(button[type="submit"])').remove(),formSubmitButtons.prepend(qrFields),quickreply.settings.ajaxSubmit){var $topicPostId=self.$.find('input[name="topic_cur_post_id"]');$topicPostId.attr("data-qr-topic-post",$topicPostId.val()).val("0")}},this.prepareForStandardSubmission=function(){var $topicPostId=quickreply.$.mainForm.find('input[name="topic_cur_post_id"]');"0"===$topicPostId.val()&&$topicPostId.val($topicPostId.attr("data-qr-topic-post")),$(window).off("beforeunload.quickreply"),quickreply.$.mainForm.off("submit")},this.setCompact=function(immediate){hideColourPalette(),closeSmileyBox();var editorElements=quickreply.style.formEditorElements(quickreply.settings.fixEmptyForm).finish();immediate?editorElements.hide():editorElements.slideUp(qrSlideInterval),setAttachNotice(immediate?"show":""),quickreply.settings.fixEmptyForm?($("#qr_text_action_box, .qr_attach_button, .qr_smiley_button").hide(),self.$.addClass("qr_compact_form"),self.is("hidden")&&$("#qr_show_fixed_form").show(),immediate?checkExtended():self.setCheckExtendedInterval()):setHidden(immediate)},this.setFixed=function(){self.is("compact")&&self.$.not(".qr_fullscreen_form").find(".qr_smiley_button").delay(qrSlideInterval/6).fadeIn().end().find(".qr_attach_button").delay(qrSlideInterval/3).fadeIn().end().removeClass("qr_compact_form").css("overflow","hidden").find("#qr_text_action_box, #qr_captcha_container, .quickreply-buttons").finish().slideDown(qrSlideInterval).promise().done((function(){self.$.css("overflow","")}))},this.initFixed=function(){quickreply.$.textarea.attr("placeholder",quickreply.language.TYPE_REPLY),quickreply.style.showQuickReplyForm(),$("#reprap").remove(),self.$.finish(),$('<div id="qr_form_placeholder" />').css("height",self.$.height()).insertAfter(self.$),self.$.addClass("qr_fixed_form"),quickreply.style.setAdditionalElements(),quickreply.settings.attachBox&&(initAttachNotice(),bindRefreshUploader()),$("#qr_action_box").prependTo(quickreply.$.messageBox),addToggleButton(),self.hasReply()||(self.$.addClass("no_transition"),self.setCompact(!0),self.$.removeClass("no_transition")),quickreply.$.textarea.addClass("qr_fixed_textarea"),quickreply.plugins.abbc3?(HTMLFormControlsCollection.log("quickreply_core",{"quickreply.plugins.abbc3":quickreply.plugins.abbc3}),$("#format-buttons").hide()):addButtonTrigger(".qr_bbcode_button","#format-buttons",hideColourPalette),addButtonTrigger(".qr_more_actions_button",".qr_fixed_form .additional-element"),$(window).on("load",(function(){self.$.find(".additional-element").length||$(".qr_more_actions_button").css("visibility","hidden")})),quickreply.$.textarea.focus((function(){self.setFixed()})),$body.on("mousedown.quickreply.form",(function(e){var $parents;$(e.target).parents().is(quickreply.$.mainForm)||quickreply.$.textarea.val()||self.is("fullscreen")||self.is("extended")||self.setCompact()})),$(".qr_form_hide_button").click((function(){setHidden()})),$(".qr_smiley_button").click((function(){smileyBoxDisplayed?closeSmileyBox():openSmileyBox()})),$(".qr_fullscreen_button").click((function(){self.is("fullscreen")?self.exitFullscreen():self.enterFullscreen()})),$(window).on("scroll resize",checkExtended),$(window).on("load",(function(){self.setCheckExtendedInterval(5e3)})),quickreply.$.qrPosts.click(self.setCheckExtendedInterval),$(window).resize(setFormWidth),$(document).ready(setFormWidth),$(window).resize(setSmileyBox)},this.setCheckExtendedInterval=function(duration,interval){checkExtendedStateChange(duration=duration||1600,interval=interval||200)},this.exitFullscreen=function(){$(document).off("keydown.quickreply.fullscreen"),self.$.off("ajax_submit_success.quickreply.fullscreen"),$body.add("html").css("overflow-y",""),hideColourPalette(),$(".qr_fixed_form").animate({maxHeight:"50%",height:formHeight,width:formWidth},qrSlideInterval,(function(){$(this).css("height","auto"),setFormWidth()})).removeClass("qr_fullscreen_form").removeAttr("style"),self.is("compact")?self.setCompact():(quickreply.style.formEditorElements().slideUp(qrSlideInterval),$("#qr_text_action_box, .qr_attach_button").show(),setAttachNotice()),$(".qr_fullscreen_button").toggleClass("fa-arrows-alt fa-times").attr("title",quickreply.language.FULLSCREEN),quickreply.$.textarea.addClass("qr_fixed_textarea"),$("#preview").insertBefore(self.$),self.$.trigger("fullscreen-exit")},this.enterFullscreen=function(){setAttachNotice(),quickreply.style.formEditorElements().slideUp(qrSlideInterval).promise().done(setFullscreen)},this.checkAttachments=function(){if(!quickreply.settings.attachBox)return!1;if(self.$.off("ajax_submit_ready ajax_submit_cancel"),uploaderIsAvailable()){if(phpbb.plupload.uploader.state!==plupload.STOPPED)return phpbb.plupload.uploader.bind("UploadComplete",(function(){self.$.trigger("ajax_submit_ready")})),!0}else if($(".file-progress:visible").length){var attachInterval=setInterval(attachmentsChecker,500);return self.$.on("ajax_submit_ready ajax_submit_cancel",(function(){clearInterval(attachInterval)})),!0}return!1},this.refresh=function(){$('button[name="post"]').removeAttr("data-clicked"),quickreply.$.textarea.val("").attr("style","height: 9em;"),$("#preview").is(":visible")&&quickreply.preview.set(),hideColourPalette(),quickreply.settings.attachBox&&($("#file-list-container").css("display","none"),$("#file-list").empty(),phpbb.plupload.clearParams(),setAttachNotice("hide"),hasAttachments=!1),quickreply.settings.allowedGuest&&quickreply.ajaxReload.start(document.location.href,{qr_captcha_refresh:1})}}function Preview(){console.log("Previev",this),this.set=function(options){var ops={display:"none",title:"",content:"",attachments:!1,removeAttachBox:!0},$preview=$("#preview");options&&(ops=$.extend(ops,options)),$preview.finish().css("display",ops.display).find("h3").html(ops.title).end().find(".post-content").html(ops.content).end(),quickreply.settings.attachBox&&(ops.removeAttachBox&&$preview.find("dl.attachbox").remove(),ops.attachments&&$preview.find(".post-content").after(ops.attachments))},this.init=function(){quickreply.style.initPreview(),$("#preview_close").click((function(){$("#preview").slideUp(qrSlideInterval),quickreply.form.setCheckExtendedInterval(qrSlideInterval)})).attr("title",quickreply.language.PREVIEW_CLOSE)}}function Ajax(){function getReplyData(merged){var replySetData={qr_no_refresh:1};return merged&&$.extend(replySetData,{qr_get_current:1}),replySetData}console.log("Ajax",this),this.init=function(){quickreply.settings.ajaxSubmit&&(quickreply.preview.init(),quickreply.$.mainForm.attr("data-ajax","qr_ajax_submit").submit((function(){quickreply.loading.start();var action=$(this).attr("action"),urlHash=action.indexOf("#");urlHash>-1&&$(this).attr("action",action.substr(0,urlHash));var $clickedButton=$(this).find('button[type="submit"][data-clicked]');if($clickedButton.length||($clickedButton=$(this).find('button[name="post"]').attr("data-clicked","true")),$("#qr_loading_explain").is(":empty"))switch($clickedButton.attr("name")){case"preview":quickreply.loading.setExplain(quickreply.language.loading.PREVIEW);break;case"post":quickreply.loading.setExplain(quickreply.language.loading.SUBMITTING)}})).attr("data-overlay",!1))},this.add=function(element){element.find("[data-ajax]").each((function(){var $this=$(this),ajax=$this.attr("data-ajax"),filter=$this.attr("data-filter");if("false"!==ajax){var fn="true"!==ajax?ajax:null;filter=void 0!==filter?phpbb.getFunctionByName(filter):null,phpbb.ajaxify({selector:this,refresh:void 0!==$this.attr("data-refresh"),filter:filter,callback:fn})}})),element.find(".display_post").click((function(e){e.preventDefault();var postId=$(this).attr("data-post-id");$("#post_content"+postId).show(),$("#profile"+postId).show(),$("#post_hidden"+postId).hide()})),handleDrops(element)},this.error=function(text){phpbb.alert(quickreply.language.AJAX_ERROR_TITLE,quickreply.language.AJAX_ERROR+(text?"<br />"+text:""))},this.submitCallback=function(res){switch(res.qr_fields&&quickreply.form.updateFields(res.qr_fields),void 0!==res.MESSAGE_TITLE?quickreply.loading.stop(!0):quickreply.loading.proceed(),res.status){case"success":quickreply.loading.setExplain(quickreply.language.loading.SUBMITTED),quickreply.ajaxReload.start(res.url.replace(/&amp;/gi,"&"),getReplyData(res.merged),{scroll:"last",callback:function(){quickreply.$.mainForm.trigger("ajax_submit_success"),quickreply.form.refresh()}});break;case"new_posts":quickreply.loading.setExplain(quickreply.language.loading.NEW_POSTS),quickreply.ajaxReload.start(res.url.replace(/&amp;/gi,"&"),getReplyData(res.merged),{scroll:"unread",loading:!0,callback:function(){quickreply.loading.stop(!0),quickreply.functions.alert(quickreply.language.INFORMATION,quickreply.language.POST_REVIEW),quickreply.settings.allowedGuest&&quickreply.ajaxReload.start(document.location.href,{qr_captcha_refresh:1})}});break;case"preview":var $preview=$("#preview");if(quickreply.preview.set({display:"block",title:res.PREVIEW_TITLE,content:res.PREVIEW_TEXT,attachments:res.PREVIEW_ATTACH}),quickreply.loading.stop(),quickreply.settings.enableScroll){var $container=!!quickreply.form.is("fullscreen")&&quickreply.$.mainForm;quickreply.functions.softScroll($preview,$container)}quickreply.$.mainForm.trigger("ajax_submit_preview",[$preview]);break;case"no_approve":quickreply.form.refresh();break;case"outdated_form":quickreply.loading.setExplain(quickreply.language.loading.NEW_FORM_TOKEN);var $clickedButton=quickreply.$.mainForm.find('button[data-clicked="true"]');setTimeout((function(){$clickedButton.click()}),2e3);break;default:res.error||quickreply.loading.stop(),quickreply.settings.allowedGuest&&quickreply.ajaxReload.start(document.location.href,{qr_captcha_refresh:1})}quickreply.$.mainForm.find("button[data-clicked]").removeAttr("data-clicked")}}function AjaxReload(){var dataObject={},params={},requestMethod="",self=this;function showResponse(elements,callback){var $submitButtons=$("#qr_submit_buttons");quickreply.form.updateFields($submitButtons.html()),qrReplaceHistory?(qrReplaceHistory=!1,phpbb.history.replaceUrl($submitButtons.attr("data-page-url"),$submitButtons.attr("data-page-title"),{url:self.url,title:$submitButtons.attr("data-page-title"),replaced:!0}),document.title=$submitButtons.attr("data-page-title")):qrStopHistory?qrStopHistory=!1:(phpbb.history.pushUrl($submitButtons.attr("data-page-url"),$submitButtons.attr("data-page-title"),{url:self.url,title:$submitButtons.attr("data-page-title")}),document.title=$submitButtons.attr("data-page-title")),$submitButtons.remove(),quickreply.style.handlePagination(),handleDrops(quickreply.style.getPagination()),quickreply.style.bindPagination(),quickreply.ajax.add(elements),quickreply.special.functions.qr_hide_subject(elements),quickreply.$.qrPosts.trigger("qr_loaded",[$(elements)]),"function"==typeof callback&&callback(getScrollElement(elements)),params.loading||quickreply.loading.stop()}function getScrollElement(elements){switch(params.scroll){case"last":return elements.find(quickreply.editor.postSelector).last();case"unread":if($(quickreply.editor.unreadPostSelector).length)return $(quickreply.editor.unreadPostSelector).first();default:return elements.children().first()}}function setDefaults(){dataObject={qr_cur_post_id:quickreply.$.mainForm.find('input[name="qr_cur_post_id"]').val(),qr_request:1},params={scroll:"",loading:!1,callback:null},requestMethod="GET"}function parseURL(){self.url.indexOf("?")<0&&(self.url=self.url.replace(/&/,"?"));var urlHash=self.url.indexOf("#");urlHash>-1&&("#unread"===self.url.substr(urlHash)&&(params.scroll="unread"),self.url=self.url.substr(0,urlHash))}function handleSEO(){if(quickreply.plugins.seo)if("unread"===params.scroll){var viewtopicLink=quickreply.editor.viewtopicLink;self.url=viewtopicLink+(viewtopicLink.indexOf("?")<0?"?":"&")+"view=unread"}else self.url.indexOf("hilit=")>-1&&(self.url=self.url.replace(/(&amp;|&|\?)hilit=([^&]*)(&amp;|&)?/,(function(str,p1,p2,p3){return $.extend(dataObject,{hilit:p2}),p3?p1:""})),requestMethod="POST")}function removePost($post){$post.closest(".post-container").remove()}function prepareMergedPost(){var $mergedPost=quickreply.$.qrPosts.find(quickreply.editor.postSelector).last();quickreply.settings.softScroll?$mergedPost.slideUp(qrSlideInterval,(function(){removePost($(this))})):quickreply.$.qrPosts.one("qr_insert_before",(function(){removePost($mergedPost)}))}function insertPosts(content){quickreply.style.markRead(quickreply.$.qrPosts);var $tempContainer=$(quickreply.editor.tempContainer);$tempContainer.html(content),qrReplaceHistory=!0,showResponse($tempContainer,(function(element){if(quickreply.settings.softScroll)$tempContainer.slideDown(qrSlideInterval,(function(){qrResponsiveLinks($tempContainer),quickreply.$.qrPosts.trigger("qr_completed",[$tempContainer]),$tempContainer.children().appendTo(quickreply.$.qrPosts),$tempContainer.hide().empty(),quickreply.settings.enableScroll&&quickreply.functions.softScroll(element)}));else{quickreply.$.qrPosts.trigger("qr_insert_before"),quickreply.style.restoreFirstSubject(quickreply.$.qrPosts,$tempContainer),$tempContainer.show(),qrResponsiveLinks($tempContainer),quickreply.$.qrPosts.trigger("qr_completed",[$tempContainer]);var $insertedPosts=$tempContainer.children().appendTo(quickreply.$.qrPosts);$tempContainer.hide().empty(),quickreply.settings.enableScroll&&quickreply.functions.softScroll($insertedPosts.first())}}))}function updatePostsContainer(content){quickreply.settings.softScroll?quickreply.$.qrPosts.slideUp(qrSlideInterval,(function(){$(this).html(content),showResponse($(this),(function(element){quickreply.$.qrPosts.slideDown(qrSlideInterval,(function(){qrResponsiveLinks(quickreply.$.qrPosts),quickreply.$.qrPosts.trigger("qr_completed",[quickreply.$.qrPosts]),quickreply.settings.enableScroll&&quickreply.functions.softScroll(element)}))}))})):(quickreply.$.qrPosts.html(content),showResponse(quickreply.$.qrPosts),qrResponsiveLinks(quickreply.$.qrPosts),quickreply.$.qrPosts.trigger("qr_completed",[quickreply.$.qrPosts]),quickreply.settings.enableScroll&&quickreply.functions.softScroll(quickreply.$.qrPosts))}function resultError(){qrStopHistory&&(qrStopHistory=!1),quickreply.ajax.error()}function resultSuccess(res){res.result?("function"==typeof params.callback&&quickreply.$.qrPosts.one("qr_completed",params.callback),res.insert?(res.merged&&prepareMergedPost(),insertPosts(res.result)):updatePostsContainer(res.result)):res.captcha_refreshed?$("#qr_captcha_container").slideUp(qrSlideInterval,(function(){quickreply.loading.stop(),$(this).html(res.captcha_result).slideDown(qrSlideInterval,(function(){quickreply.$.mainForm.trigger("qr_captcha_refreshed")}))})):(qrStopHistory&&(qrStopHistory=!1),quickreply.ajax.error(res.MESSAGE_TEXT))}function standardReload(url){quickreply.form.prepareForStandardSubmission(),quickreply.$.mainForm.attr("action",url).submit()}self.url="",this.loadPage=function(url){quickreply.settings.ajaxPagination?self.start(url):standardReload(url)},this.start=function(url,requestData,requestParams){quickreply.loading.start(),setDefaults(),self.url=url,parseURL(),handleSEO(),requestData&&$.extend(dataObject,requestData),requestParams&&$.extend(params,requestParams),$.ajax({url:self.url,data:dataObject,method:requestMethod,error:resultError,success:resultSuccess,cache:!1})}}""!==restoredMessage&&quickreply.$.textarea.val(restoredMessage),quickreply.style.setPostReplyHandler(),quickreply.settings.ajaxSubmit&&phpbb.addAjaxCallback("qr_ajax_submit",quickreply.ajax.submitCallback)}(jQuery,window,document);